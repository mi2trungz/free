<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dự án chia sẻ tài khoản miễn phí</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/otpauth/9.1.4/otpauth.umd.min.js"></script>
    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAnalytics } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js';
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged, sendPasswordResetEmail } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyAVV-3HxGFpT_eiAri1SGPWGwu3EL8On58",
            authDomain: "trada3k-c402a.firebaseapp.com",
            projectId: "trada3k-c402a",
            storageBucket: "trada3k-c402a.firebasestorage.app",
            messagingSenderId: "1047457871868",
            appId: "1:1047457871868:web:f1d9ec6316d6847bca2479",
            measurementId: "G-YYHGR91MG6"
        };

        const app = initializeApp(firebaseConfig);
        const analytics = typeof window !== 'undefined' ? getAnalytics(app) : null;
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.firebaseAuth = auth;
        window.firebaseSignIn = signInWithEmailAndPassword;
        window.firebaseSignUp = createUserWithEmailAndPassword;
        window.firebaseSignOut = signOut;
        window.firebaseOnAuthStateChanged = onAuthStateChanged;
        window.firebaseSendPasswordReset = sendPasswordResetEmail;
        window.firebaseDb = db;
        window.firebaseDoc = doc;
        window.firebaseSetDoc = setDoc;
        window.firebaseGetDoc = getDoc;
        window.firebaseOnSnapshot = onSnapshot;
    </script>
    <style>
        .hidden {
            display: none !important;
        }

        @import url('https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap');

        /* --- GLOBAL & BACKGROUND --- */
        body {
            font-family: 'Be Vietnam Pro', sans-serif;
            /* Restored Font */
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #1f2937;
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
            background-attachment: fixed;
        }

        /* --- UTILITIES --- */
        .glass,
        .glass-heavy,
        .glass-dark {
            background-color: #ffffff;
            border: 1px solid #cbd5e1;
            /* Darker border for visibility */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        /* --- SCROLLBAR --- */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        ::-webkit-scrollbar-thumb {
            background: #c7c7c7;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: linear-gradient(to bottom, #818cf8, #c084fc);
        }

        /* --- ANIMATIONS --- */
        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.95) translateY(10px);
            }

            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .fade-in {
            animation: fadeInScale 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }

        /* --- COMPONENT STYLES --- */

        /* Enhanced Cards for better visibility */
        .card {
            background-color: #ffffff;
            border-radius: 0.75rem;
            border: 1px solid #cbd5e1;
            /* Slate-300: Darker border */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            /* Stronger shadow */
            transition: all 0.2s;
        }

        .card:hover {
            border-color: #94a3b8;
            /* Slate-400 */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transform: translateY(-2px);
        }

        /* Buttons */
        /* Buttons */
        .btn-primary {
            background-color: #4f46e5;
            /* indigo-600 */
            color: white;
            border-radius: 0.5rem;
            font-weight: 600;
            padding: 0.5rem 1rem;
            transition: background-color 0.2s;
            border: none;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }

        .btn-primary:hover {
            background-color: #4338ca;
            /* indigo-700 */
            transform: none;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        /* Text Gradients */
        .text-gradient {
            background: linear-gradient(135deg, #4f46e5 0%, #9333ea 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Input Fields */
        /* Input Fields */
        .input-field {
            background-color: #ffffff;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            padding: 0.5rem 0.75rem;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        }

        .input-field:focus {
            border-color: #4f46e5;
            outline: 2px solid #e0e7ff;
        }

        /* Header Specifics */
        .header-glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* Utilities */
        .code-font {
            font-family: 'JetBrains Mono', monospace;
        }

        .slide-up {
            animation: fadeInScale 0.6s ease-out;
        }

        @media (min-width: 768px) {
            #mainApp {
                max-width: 1200px;
            }
        }

        @media (min-width: 1024px) {
            #mainApp {
                max-width: 1400px;
            }
        }
    </style>
</head>

<body class="min-h-screen flex items-center justify-center p-4 md:p-6 lg:p-8">

    <!-- MODAL NHẬP MẬT KHẨU -->
    <div id="passwordModal"
        class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm p-4 fade-in">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden relative">
            <button onclick="closePasswordModal()"
                class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors"><svg
                    xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg></button>
            <div class="p-8 text-center">
                <div class="w-14 h-14 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-indigo-600" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                    </svg>
                </div>
                <h3 class="text-xl font-bold text-gray-800 mb-2">Yêu cầu bảo mật</h3>
                <p class="text-sm text-gray-500 mb-6">Vui lòng nhập mật mã để truy cập danh mục này.</p>
                <div class="space-y-3">
                    <input type="password" id="modalPasswordInput"
                        class="w-full px-4 py-3 rounded-xl border-2 border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all text-center tracking-widest text-xl font-bold bg-white shadow-inner"
                        placeholder="• • • •" maxlength="4" oninput="checkModalAutoLogin()">
                    <p class="text-xs text-red-500 italic font-medium">Lưu ý: Mật khẩu sẽ được thay đổi thường xuyên</p>
                    <button onclick="checkModalPassword()"
                        class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold py-3 rounded-xl hover:from-indigo-700 hover:to-purple-700 transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">Mở
                        Khóa</button>
                    <button onclick="openInstructions()"
                        class="w-full text-indigo-600 font-medium py-2 rounded-xl hover:bg-indigo-50 transition-colors text-sm border border-indigo-200">Lấy
                        mã?</button>
                    <p id="modalLoginError" class="text-red-500 text-sm font-medium hidden mt-2">Mật mã không đúng!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL LƯU Ý -->
    <div id="disclaimerModal"
        class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm p-4 fade-in">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden">
            <div class="bg-yellow-50 p-6 border-b border-yellow-100 flex items-center gap-3">
                <div class="p-2 bg-yellow-100 rounded-full text-yellow-600"><svg xmlns="http://www.w3.org/2000/svg"
                        class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                    </svg></div>
                <h3 class="text-lg font-bold text-gray-800">Lưu ý quan trọng</h3>
            </div>
            <div class="p-6">
                <ul id="disclaimerList" class="space-y-3 text-sm text-gray-600"></ul>
                <button id="confirmBtn" onclick="confirmDisclaimer()" disabled
                    class="mt-6 w-full bg-gray-200 text-gray-500 font-bold py-3 rounded-xl transition-all cursor-not-allowed">Vui
                    lòng chờ 3s...</button>
            </div>
        </div>
    </div>

    <!-- MODAL HƯỚNG DẪN -->
    <div id="instructionModal"
        class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm p-4 fade-in">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden relative">
            <button onclick="closeInstructions()"
                class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors"><svg
                    xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg></button>
            <div class="p-8">
                <div class="w-14 h-14 bg-indigo-100 rounded-full flex items-center justify-center mb-4"><svg
                        xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-indigo-600" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg></div>
                <h3 class="text-xl font-bold text-gray-800 mb-2">Hướng dẫn lấy mã</h3>
                <div class="space-y-4 text-sm text-gray-600 mt-4">
                    <p>Để nhận mật mã truy cập vào hệ thống, bạn vui lòng thực hiện các bước sau:</p>
                    <ol class="list-decimal pl-5 space-y-2 marker:text-indigo-600 marker:font-bold">
                        <li>Liên hệ Admin qua Facebook.</li>
                        <li>Gửi yêu cầu "Cấp quyền truy cập 2FA".</li>
                        <li>Admin sẽ xác minh và gửi mã cho bạn.</li>
                    </ol>
                    <div
                        class="p-3 bg-red-50 text-red-600 text-xs rounded-lg font-medium border border-red-100 flex items-start gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 shrink-0 mt-0.5" fill="none"
                            viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <span>Lưu ý: Mã sẽ được thay đổi mỗi ngày.</span>
                    </div>
                    <a href="https://facebook.com/DTH.3006" target="_blank"
                        class="block bg-slate-50 border border-slate-200 p-3 rounded-lg text-center mt-4 hover:bg-indigo-50 hover:border-indigo-200 transition-all group cursor-pointer decoration-0">
                        <p class="text-xs text-gray-500 uppercase font-semibold mb-1">Liên hệ Admin</p>
                        <div
                            class="text-indigo-600 font-bold group-hover:text-indigo-700 flex items-center justify-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                viewBox="0 0 16 16">
                                <path
                                    d="M16 8.049c0-4.446-3.582-8.05-8-8.05C3.58 0-.002 3.603-.002 8.05c0 4.017 2.926 7.347 6.75 7.951v-5.625h-2.03V8.05H6.75V6.275c0-2.017 1.195-3.131 3.022-3.131.876 0 1.791.157 1.791.157v1.98h-1.009c-.993 0-1.303.621-1.303 1.258v1.51h2.218l-.354 2.326H9.25V16c3.824-.604 6.75-3.934 6.75-7.951" />
                            </svg> Facebook: Đào Thái Hải
                        </div>
                    </a>
                </div>
                <button onclick="closeInstructions()"
                    class="mt-6 w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold py-3 rounded-xl hover:from-indigo-700 hover:to-purple-700 transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">Đã
                    hiểu</button>
            </div>
        </div>
    </div>

    <!-- MODAL ĐĂNG NHẬP/ĐĂNG KÝ -->
    <div id="authModal"
        class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm p-4 fade-in">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden relative">
            <button onclick="closeAuthModal()"
                class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors z-10">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>

            <!-- Tab Navigation -->
            <div class="flex border-b border-gray-200">
                <button id="loginTab" onclick="switchAuthTab('login')"
                    class="flex-1 py-4 px-6 text-center font-semibold text-indigo-600 border-b-2 border-indigo-600 transition-colors">
                    Đăng nhập
                </button>
                <button id="registerTab" onclick="switchAuthTab('register')"
                    class="flex-1 py-4 px-6 text-center font-semibold text-gray-500 hover:text-gray-700 transition-colors">
                    Đăng ký
                </button>
            </div>

            <div class="p-8">
                <!-- Login Form -->
                <div id="loginForm" class="space-y-4">
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-indigo-600" fill="none"
                                viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                            </svg>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-2">Chào mừng trở lại!</h3>
                        <p class="text-sm text-gray-500">Đăng nhập để tiếp tục sử dụng dịch vụ</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                        <input type="email" id="loginEmail"
                            class="w-full px-4 py-3 rounded-xl border-2 border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all input-field"
                            placeholder="your@email.com">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Mật khẩu</label>
                        <input type="password" id="loginPassword"
                            class="w-full px-4 py-3 rounded-xl border-2 border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all input-field"
                            placeholder="••••••••">
                    </div>

                    <button onclick="forgotPassword()"
                        class="text-sm text-indigo-600 hover:text-indigo-700 font-medium text-right w-full">Quên mật
                        khẩu?</button>

                    <p id="loginError" class="text-red-500 text-sm font-medium hidden text-center"></p>

                    <button onclick="handleLogin()" id="loginBtn"
                        class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold py-3 rounded-xl hover:from-indigo-700 hover:to-purple-700 transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                        Đăng nhập
                    </button>
                </div>

                <!-- Register Form -->
                <div id="registerForm" class="space-y-4 hidden">
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-purple-600" fill="none"
                                viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" />
                            </svg>
                        </div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-2">Tạo tài khoản mới</h3>
                        <p class="text-sm text-gray-500">Đăng ký để bắt đầu sử dụng dịch vụ</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                        <input type="email" id="registerEmail"
                            class="w-full px-4 py-3 rounded-xl border-2 border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all input-field"
                            placeholder="your@email.com">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Mật khẩu</label>
                        <input type="password" id="registerPassword"
                            class="w-full px-4 py-3 rounded-xl border-2 border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all input-field"
                            placeholder="Tối thiểu 6 ký tự">
                        <p class="text-xs text-gray-500 mt-1">Mật khẩu phải có ít nhất 6 ký tự</p>
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Xác nhận mật khẩu</label>
                        <input type="password" id="registerPasswordConfirm"
                            class="w-full px-4 py-3 rounded-xl border-2 border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none transition-all input-field"
                            placeholder="Nhập lại mật khẩu">
                    </div>

                    <p id="registerError" class="text-red-500 text-sm font-medium hidden text-center"></p>

                    <button onclick="handleRegister()" id="registerBtn"
                        class="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white font-semibold py-3 rounded-xl hover:from-purple-700 hover:to-pink-700 transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">
                        Đăng ký
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL QUẢN LÝ ADMIN -->
    <div id="adminModal"
        class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm p-4 fade-in overflow-y-auto">
        <div class="bg-white rounded-2xl shadow-2xl max-w-4xl w-full overflow-hidden relative my-8">
            <button onclick="closeAdminModal()"
                class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors z-10">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>

            <div class="bg-gradient-to-r from-red-600 to-pink-600 px-6 py-4">
                <h3 class="text-xl font-bold text-white flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                    </svg>
                    Quản lý Admin
                </h3>
            </div>

            <div class="p-6">
                <!-- Tab Navigation -->
                <div class="flex border-b border-gray-200 mb-6">
                    <button id="adminFoldersTab" onclick="switchAdminTab('folders')"
                        class="px-6 py-3 font-semibold text-indigo-600 border-b-2 border-indigo-600 transition-colors">
                        Quản lý Danh mục
                    </button>
                    <button id="adminAccountsTab" onclick="switchAdminTab('accounts')"
                        class="px-6 py-3 font-semibold text-gray-500 hover:text-gray-700 transition-colors">
                        Quản lý Tài khoản
                    </button>
                </div>

                <!-- Folders Management -->
                <div id="adminFoldersContent" class="space-y-4">
                    <div class="flex justify-between items-center mb-4">
                        <h4 class="text-lg font-bold text-gray-800">Danh sách danh mục</h4>
                        <div class="flex gap-2">
                            <button onclick="forceSyncToFirestore()"
                                class="bg-gradient-to-r from-green-600 to-emerald-600 text-white px-4 py-2 rounded-lg hover:from-green-700 hover:to-emerald-700 transition-all text-sm font-semibold flex items-center gap-2"
                                title="Đồng bộ dữ liệu lên Firestore">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                                </svg>
                                Đồng bộ
                            </button>
                            <button onclick="openAddFolderModal()"
                                class="bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-4 py-2 rounded-lg hover:from-indigo-700 hover:to-purple-700 transition-all text-sm font-semibold flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                                    stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 4v16m8-8H4" />
                                </svg>
                                Thêm danh mục
                            </button>
                        </div>
                    </div>
                    <div id="adminFoldersList" class="space-y-2 max-h-96 overflow-y-auto custom-scrollbar"></div>
                </div>

                <!-- Accounts Management -->
                <div id="adminAccountsContent" class="space-y-4 hidden">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Chọn danh mục</label>
                        <select id="adminFolderSelect" onchange="loadAccountsForAdmin()"
                            class="w-full px-4 py-2 rounded-xl border-2 border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none">
                            <option value="">-- Chọn danh mục --</option>
                        </select>
                    </div>
                    <div id="adminAccountsList" class="space-y-3 max-h-96 overflow-y-auto custom-scrollbar"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL THÊM/SỬA DANH MỤC -->
    <div id="folderEditModal"
        class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm p-4 fade-in">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden relative">
            <button onclick="closeFolderEditModal()"
                class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <div class="p-6">
                <h3 id="folderEditTitle" class="text-xl font-bold text-gray-800 mb-4">Thêm danh mục mới</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tên danh mục</label>
                        <input type="text" id="folderNameInput"
                            class="w-full px-4 py-2 rounded-xl border-2 border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none"
                            placeholder="VD: CHAT GPT GO">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ID danh mục</label>
                        <input type="text" id="folderIdInput"
                            class="w-full px-4 py-2 rounded-xl border-2 border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none"
                            placeholder="VD: chatgpt-go">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">URL Icon</label>
                        <input type="text" id="folderIconInput"
                            class="w-full px-4 py-2 rounded-xl border-2 border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none"
                            placeholder="https://...">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Lưu ý Popup (Disclaimer - Mỗi dòng 1
                            ý)</label>
                        <textarea id="folderNotesInput" rows="3"
                            class="w-full px-4 py-2 rounded-xl border-2 border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none"
                            placeholder="Hiện khi bấm vào folder..."></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Lưu ý trong danh mục (Mỗi dòng 1
                            ý)</label>
                        <textarea id="folderCategoryNotesInput" rows="3"
                            class="w-full px-4 py-2 rounded-xl border-2 border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none"
                            placeholder="Hiện ở đầu danh sách tài khoản..."></textarea>
                    </div>
                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="folderMaintenanceInput" class="w-4 h-4 text-indigo-600 rounded">
                        <label for="folderMaintenanceInput" class="text-sm text-gray-700">Đang bảo trì</label>
                    </div>
                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="folderHiddenInput" class="w-4 h-4 text-orange-600 rounded">
                        <label for="folderHiddenInput" class="text-sm text-gray-700">Tạm ẩn danh mục</label>
                    </div>

                    <p id="folderEditError" class="text-red-500 text-sm hidden"></p>
                    <button onclick="saveFolder()"
                        class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold py-3 rounded-xl hover:from-indigo-700 hover:to-purple-700 transition-all">
                        Lưu
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL THÊM/SỬA TÀI KHOẢN -->
    <div id="accountEditModal"
        class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm p-4 fade-in">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden relative">
            <button onclick="closeAccountEditModal()"
                class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <div class="p-6">
                <h3 id="accountEditTitle" class="text-xl font-bold text-gray-800 mb-4">Thêm tài khoản mới</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tên tài khoản</label>
                        <input type="text" id="accountNameInput"
                            class="w-full px-4 py-2 rounded-xl border-2 border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none"
                            placeholder="VD: GPT Go 1">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Username/Email</label>
                        <input type="text" id="accountUsernameInput"
                            class="w-full px-4 py-2 rounded-xl border-2 border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none"
                            placeholder="user@example.com">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Mật khẩu</label>
                        <input type="text" id="accountPasswordInput"
                            class="w-full px-4 py-2 rounded-xl border-2 border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none"
                            placeholder="Password123">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Secret Key (2FA)</label>
                        <input type="text" id="accountSecretInput"
                            class="w-full px-4 py-2 rounded-xl border-2 border-gray-300 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none font-mono text-sm"
                            placeholder="ABCD1234...">
                    </div>
                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="accountShowOtpInput" class="w-4 h-4 text-indigo-600 rounded" checked>
                        <label for="accountShowOtpInput" class="text-sm text-gray-700">Hiển thị mã 2FA</label>
                    </div>
                    <div class="flex items-center gap-2">
                        <input type="checkbox" id="accountHiddenInput" class="w-4 h-4 text-orange-600 rounded">
                        <label for="accountHiddenInput" class="text-sm text-gray-700">Tạm ẩn tài khoản</label>
                    </div>
                    <p id="accountEditError" class="text-red-500 text-sm hidden"></p>
                    <button onclick="saveAccount()"
                        class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold py-3 rounded-xl hover:from-indigo-700 hover:to-purple-700 transition-all">
                        Lưu
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL THÔNG BÁO -->
    <div id="alertModal"
        class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm p-4 fade-in">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden relative">
            <button onclick="closeAlertModal()"
                class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <div class="p-6 text-center">
                <div id="alertIcon" class="w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4">
                    <!-- Icon sẽ được thay đổi động -->
                </div>
                <h3 id="alertTitle" class="text-xl font-bold text-gray-800 mb-2">Thông báo</h3>
                <p id="alertMessage" class="text-sm text-gray-600 mb-6 whitespace-pre-line"></p>
                <button onclick="closeAlertModal()"
                    class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold py-3 rounded-xl hover:from-indigo-700 hover:to-purple-700 transition-all shadow-lg hover:shadow-xl">
                    Đã hiểu
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL XÁC NHẬN -->
    <div id="confirmModal"
        class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm p-4 fade-in">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden relative">
            <button onclick="closeConfirmModal(false)"
                class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <div class="p-6 text-center">
                <div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-yellow-600" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                    </svg>
                </div>
                <h3 id="confirmTitle" class="text-xl font-bold text-gray-800 mb-2">Xác nhận</h3>
                <p id="confirmMessage" class="text-sm text-gray-600 mb-6"></p>
                <div class="flex gap-3">
                    <button onclick="closeConfirmModal(false)"
                        class="flex-1 bg-gray-200 text-gray-700 font-semibold py-3 rounded-xl hover:bg-gray-300 transition-all">
                        Hủy
                    </button>
                    <button onclick="closeConfirmModal(true)" id="confirmOkBtn"
                        class="flex-1 bg-gradient-to-r from-red-600 to-pink-600 text-white font-semibold py-3 rounded-xl hover:from-red-700 hover:to-pink-700 transition-all shadow-lg hover:shadow-xl">
                        Xác nhận
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL HƯỚNG DẪN CAPCUT -->
    <div id="capcutGuideModal"
        class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm p-4 fade-in">
        <div class="glass-heavy rounded-2xl max-w-md w-full overflow-hidden relative">
            <button onclick="closeCapcutGuide()"
                class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors"><svg
                    xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg></button>
            <div class="p-6">
                <h3 id="capcutGuideTitle" class="text-lg font-bold text-gray-800 mb-4">Hướng dẫn</h3>
                <div id="capcutGuideContent" class="space-y-3 text-sm text-gray-600"></div>
                <button onclick="closeCapcutGuide()"
                    class="mt-6 w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold py-3 rounded-xl hover:from-indigo-700 hover:to-purple-700 transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5">Đã
                    hiểu</button>
            </div>
        </div>
    </div>

    <!-- MODAL CHI TIẾT TÀI KHOẢN -->
    <div id="accountDetailModal" onclick="if(event.target === this) closeAccountDetailModal()"
        class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/70 backdrop-blur-sm p-4 fade-in">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full overflow-hidden relative">
            <button onclick="closeAccountDetailModal()"
                class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors z-10">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <div class="p-0 overflow-hidden">
                <div class="bg-gradient-to-r from-indigo-500 to-purple-600 p-6 text-center relative overflow-hidden">
                    <div class="absolute top-0 left-0 w-full h-full opacity-10">
                        <svg class="w-full h-full" viewBox="0 0 100 100" preserveAspectRatio="none">
                            <path d="M0 100 C 20 0 50 0 100 100 Z" fill="white" />
                        </svg>
                    </div>
                    <div id="modalAccountIcon"
                        class="w-20 h-20 rounded-2xl mx-auto mb-3 flex items-center justify-center overflow-hidden bg-white/20 backdrop-blur-sm border-2 border-white/30 shadow-lg relative z-10">
                        <!-- Icon here -->
                    </div>
                </div>
                <div class="px-6 pb-6 pt-4">
                    <div class="text-center mb-6">
                        <h3 id="modalAccountName" class="text-xl font-bold text-gray-800">Account Name</h3>
                        <p id="modalAccountSubtitle" class="text-sm text-gray-500 font-mono mt-1">Username</p>
                    </div>

                    <div class="space-y-4">
                        <div class="relative">
                            <label
                                class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5 ml-1">Tài
                                khoản</label>
                            <div
                                class="flex items-center gap-2 bg-gray-50 border border-gray-200 p-3 rounded-xl hover:border-indigo-300 transition-colors group">
                                <input type="text" id="modalAccountUsername" readonly
                                    class="bg-transparent outline-none text-sm text-gray-800 font-mono w-full font-bold">
                                <button
                                    onclick="copyToClipboardText(document.getElementById('modalAccountUsername').value, this)"
                                    class="text-gray-400 group-hover:text-indigo-600 transition-colors p-1.5 hover:bg-white rounded-lg shadow-sm"><svg
                                        xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                    </svg></button>
                            </div>
                        </div>

                        <div class="relative">
                            <label
                                class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5 ml-1">Mật
                                khẩu</label>
                            <div
                                class="flex items-center gap-2 bg-gray-50 border border-gray-200 p-3 rounded-xl hover:border-indigo-300 transition-colors group">
                                <input type="text" id="modalAccountPassword" readonly
                                    class="bg-transparent outline-none text-sm text-gray-800 font-mono w-full font-bold">
                                <button
                                    onclick="copyToClipboardText(document.getElementById('modalAccountPassword').value, this)"
                                    class="text-gray-400 group-hover:text-indigo-600 transition-colors p-1.5 hover:bg-white rounded-lg shadow-sm"><svg
                                        xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                                    </svg></button>
                            </div>
                            <p class="text-[10px] text-gray-500 italic mt-1.5 ml-1">⚠️ Mật khẩu có thể thay đổi, vui
                                lòng
                                kiểm tra kỹ.</p>
                        </div>

                        <div id="modalOtpSection" class="hidden">
                            <div
                                class="bg-indigo-50 border border-indigo-100 p-4 rounded-xl mt-4 relative overflow-hidden">
                                <div class="absolute top-0 right-0 p-2 opacity-10"><svg
                                        xmlns="http://www.w3.org/2000/svg" class="h-24 w-24 text-indigo-600" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                                    </svg></div>

                                <div class="flex items-center justify-between relative z-10">
                                    <div>
                                        <span
                                            class="text-[10px] text-indigo-800 font-bold uppercase tracking-wider block mb-1">Mã
                                            xác minh 2FA</span>
                                        <div class="flex items-center gap-3">
                                            <div class="font-mono font-bold text-indigo-700 text-3xl tracking-widest"
                                                id="modalOtpValue">... ...</div>
                                            <button
                                                onclick="copyToClipboardText(document.getElementById('modalOtpValue').innerText.replace(/\s/g,''), this)"
                                                class="px-3 py-1.5 bg-indigo-600 text-white text-xs font-bold rounded-lg hover:bg-indigo-700 transition-colors shadow-sm active:scale-95">Sao
                                                chép</button>
                                        </div>
                                    </div>
                                    <div class="relative w-12 h-12 flex items-center justify-center flex-shrink-0">
                                        <svg class="transform -rotate-90 w-12 h-12">
                                            <circle cx="24" cy="24" r="18" stroke="#e0e7ff" stroke-width="3"
                                                fill="transparent" />
                                            <circle id="modalTimerRing" cx="24" cy="24" r="18" stroke="#4f46e5"
                                                stroke-width="3" fill="transparent" class="progress-ring"
                                                stroke-dasharray="113.1" stroke-dashoffset="0" />
                                        </svg>
                                        <span id="modalTimerText"
                                            class="absolute text-sm font-bold text-indigo-900">30</span>
                                    </div>
                                </div>
                                <p
                                    class="text-[10px] text-indigo-600 font-medium mt-2 bg-white/50 inline-block px-2 py-1 rounded w-full text-center">
                                    ⚠️ Mã sẽ bị vô hiệu sau mỗi 30 giây, sau mỗi 30 giây vui lòng dùng mã mới</p>
                            </div>
                        </div>

                        <div id="modalAdminControls" class="hidden mt-4 pt-4 border-t border-gray-100 flex gap-3">
                            <!-- Admin buttons injected here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- LANDING PAGE (Disabled by default mechanism) -->
    <div id="landingPage" class="w-full max-w-md md:max-w-2xl lg:max-w-4xl xl:max-w-6xl fade-in hidden">
        <div class="glass rounded-2xl overflow-hidden">
            <div class="px-8 py-12 md:px-12 md:py-16 text-center">
                <div class="mb-6">
                    <div
                        class="w-20 h-20 md:w-24 md:h-24 bg-gradient-to-br from-indigo-500 to-pink-500 rounded-2xl mx-auto mb-6 flex items-center justify-center shadow-lg float">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-12 h-12 md:w-16 md:h-16 text-white" fill="none"
                            viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                        </svg>
                    </div>
                    <h1
                        class="text-4xl md:text-5xl lg:text-6xl font-extrabold mb-4 slide-up bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 bg-clip-text text-transparent pb-2">
                        Dự án chia sẻ tài
                        khoản miễn phí</h1>
                    <p class="text-lg md:text-xl text-gray-600 mb-2 slide-up font-medium" style="animation-delay: 0.1s">
                        Chia sẻ
                        tài khoản Premium cho cộng đồng</p>
                    <p class="text-sm md:text-base text-gray-500 slide-up" style="animation-delay: 0.2s">Hoàn
                        toàn
                        phi
                        lợi nhuận</p>
                </div>
            </div>
            <div class="p-8 md:p-12">
                <div class="text-center mb-8">
                    <h2 class="text-2xl md:text-3xl font-bold text-gray-900 mb-4 slide-up"
                        style="animation-delay: 0.3s">Chào mừng bạn đến với dự án!</h2>
                    <p class="text-gray-600 mb-6 leading-relaxed max-w-2xl mx-auto slide-up"
                        style="animation-delay: 0.4s">
                        Chúng tôi cung cấp các tài khoản Premium chất lượng cao phục vụ cộng đồng hoàn toàn miễn
                        phí.
                        Hãy khám phá và sử dụng các dịch vụ tuyệt vời này.
                    </p>
                    <div class="flex flex-wrap justify-center gap-4 mb-8 slide-up" style="animation-delay: 0.5s">
                        <div class="flex items-center gap-2 text-gray-700 bg-gray-50 px-4 py-2 rounded-lg">
                            <svg class="w-5 h-5 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M5 13l4 4L19 7" />
                            </svg>
                            <span class="text-sm font-medium">100% Miễn phí</span>
                        </div>
                        <div class="flex items-center gap-2 text-gray-700 bg-gray-50 px-4 py-2 rounded-lg">
                            <svg class="w-5 h-5 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M5 13l4 4L19 7" />
                            </svg>
                            <span class="text-sm font-medium">Tài khoản Premium</span>
                        </div>
                        <div class="flex items-center gap-2 text-gray-700 bg-gray-50 px-4 py-2 rounded-lg">
                            <svg class="w-5 h-5 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M5 13l4 4L19 7" />
                            </svg>
                            <span class="text-sm font-medium">Cập nhật thường xuyên</span>
                        </div>
                    </div>
                </div>
                <div class="text-center slide-up" style="animation-delay: 0.6s">
                    <button onclick="openAuthModal()"
                        class="w-full md:w-auto mx-auto block bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-bold py-4 px-12 rounded-xl hover:from-indigo-700 hover:to-purple-700 transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-1 text-lg">
                        Đăng nhập để bắt đầu
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 inline-block ml-2" fill="none"
                            viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M13 7l5 5m0 0l-5 5m5-5H6" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ỨNG DỤNG CHÍNH -->
    <div id="mainApp"
        class="bg-white w-full max-w-md md:max-w-2xl lg:max-w-4xl xl:max-w-6xl rounded-2xl overflow-hidden h-auto flex flex-col hidden shadow-2xl ring-1 ring-black/5 mx-4 my-6 relative z-10">
        <div
            class="px-5 py-6 md:px-8 md:py-8 relative bg-gradient-to-r from-indigo-600 via-purple-600 to-pink-600 text-white">
            <div class="absolute top-6 right-6 flex items-center gap-3 z-50">
                <button id="headerLoginBtn" onclick="openAuthModal()"
                    class="text-white hover:text-white transition-colors flex items-center gap-2 text-sm font-bold bg-white/20 hover:bg-white/30 px-4 py-2 rounded-xl transition-all backdrop-blur-sm border border-white/20">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1" />
                    </svg>
                    Đăng nhập
                </button>
                <button id="adminBtn" onclick="openAdminModal()"
                    class="hidden text-white hover:text-white transition-colors flex items-center gap-2 text-sm font-semibold bg-white/20 hover:bg-white/30 px-3 py-1.5 rounded-lg border border-white/20">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                    </svg>
                    Quản lý
                </button>
                <button id="logoutBtn" onclick="handleLogout()"
                    class="text-white hover:text-red-100 transition-colors flex items-center gap-2 text-sm font-semibold hidden hover:bg-red-500/20 px-3 py-1.5 rounded-lg border border-white/20 bg-white/10">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                    </svg>
                    Đăng xuất
                </button>
            </div>
            <h1 class="text-2xl md:text-3xl lg:text-4xl font-extrabold text-center text-white mb-2 drop-shadow-md">
                Dự án chia sẻ tài khoản miễn
                phí</h1>
            <p id="headerSubtitle" class="text-sm md:text-base text-indigo-100 text-center font-medium opacity-90">Danh
                mục
                tài khoản</p>
            <p id="userEmail"
                class="text-xs text-indigo-600 text-center mt-3 font-mono bg-white px-3 py-1 rounded-full w-fit mx-auto shadow-sm font-bold">
            </p>
        </div>

        <div class="p-6 md:p-8 flex-1 flex flex-col">
            <!-- Intro & Liên hệ -->
            <div id="introSection"
                class="bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-100 rounded-xl p-4 mb-4 shadow-sm">
                <div class="flex flex-col md:flex-row items-center justify-between gap-4">
                    <div class="text-center md:text-left">
                        <h2
                            class="text-sm md:text-base font-bold text-gray-900 mb-1 flex items-center justify-center md:justify-start gap-2">
                            <span class="text-xl">👋</span> Xin chào!
                        </h2>
                        <p class="text-xs md:text-sm text-gray-700 leading-relaxed max-w-xl">Chào mừng đến với <strong
                                class="text-indigo-700">Dự án chia sẻ tài khoản miễn phí</strong> phi lợi nhuận.</p>
                    </div>
                </div>
            </div>

            <!-- Navbar -->
            <div id="navBar"
                class="hidden flex items-center gap-2 mb-5 text-sm text-gray-600 bg-gray-50 px-4 py-2.5 rounded-lg">
                <button onclick="showFolders()"
                    class="hover:text-indigo-600 flex items-center gap-1 font-medium transition-colors">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24"
                        stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                    </svg> Quay lại
                </button>
                <span class="text-gray-300">/</span>
                <span id="currentFolderName" class="text-indigo-600 font-semibold truncate max-w-[150px]">...</span>
            </div>

            <div class="mb-6 flex-1">
                <div id="extraHeaderContent" class="hidden mb-5"></div>
                <!-- SECTION LIÊN HỆ MỚI (Đã chuyển lên trên) -->
                <div id="contactSection" class="mb-8 border-b border-dashed border-gray-200 pb-6">
                    <p class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-4 text-center">Liên hệ hỗ trợ
                    </p>
                    <div class="flex flex-col sm:flex-row items-center justify-center gap-4">
                        <a href="https://facebook.com/DTH.3006" target="_blank"
                            class="flex items-center justify-center gap-2 bg-[#1877F2] text-white px-5 py-2.5 rounded-xl font-semibold hover:bg-[#166fe5] transition-all text-sm shadow-sm hover:shadow-md transform hover:-translate-y-0.5 whitespace-nowrap w-full sm:w-auto min-w-[140px]">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="currentColor"
                                viewBox="0 0 24 24">
                                <path
                                    d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z" />
                            </svg> Đào Thái Hải
                        </a>
                        <a href="mailto:thaihai.3006@gmail.com"
                            class="flex items-center justify-center gap-2 bg-white text-gray-700 border border-gray-200 px-5 py-2.5 rounded-xl font-semibold hover:bg-gray-50 hover:border-gray-300 hover:text-red-600 transition-all text-sm shadow-sm hover:shadow-md transform hover:-translate-y-0.5 whitespace-nowrap w-full sm:w-auto min-w-[140px]">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-500" viewBox="0 0 24 24"
                                fill="currentColor">
                                <path
                                    d="M1.5 8.67v8.58a3 3 0 003 3h15a3 3 0 003-3V8.67l-8.928 5.493a3 3 0 01-3.144 0L1.5 8.67z" />
                                <path
                                    d="M22.5 6.908V6.75a3 3 0 00-3-3h-15a3 3 0 00-3 3v.158l9.714 5.978a1.5 1.5 0 001.572 0L22.5 6.908z" />
                            </svg> thaihai.3006@gmail.com
                        </a>
                    </div>
                </div>

                <div id="listTitle" class="text-xs font-bold text-gray-600 uppercase tracking-wider mb-4">Chọn
                    danh
                    mục
                </div>
                <div id="listContainer"
                    class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 fade-in pb-2">
                </div>

                <!-- Dòng Update (Đã chuyển xuống dưới) -->
                <div id="lastUpdateLabel"
                    class="flex items-center justify-center gap-2 mt-6 mb-2 text-[10px] md:text-xs text-indigo-600 bg-indigo-50 px-3 py-1.5 rounded-full w-fit mx-auto border border-indigo-100">
                    <span class="relative flex h-2 w-2"><span
                            class="animate-ping absolute inline-flex h-full w-full rounded-full bg-indigo-400 opacity-75"></span><span
                            class="relative inline-flex rounded-full h-2 w-2 bg-indigo-500"></span></span> Updated:
                    04:44 06/12/2025
                </div>


            </div>

            <div id="homeFooter" class="mt-auto pt-5 border-t border-gray-200">
                <p class="text-center text-xs text-gray-500 mt-2">Dự án được phát triển bởi <span
                        class="font-semibold text-indigo-600">Đào Thái Hải</span></p>
            </div>
        </div>
    </div>

    <!-- SCRIPT -->
    <script>
        // Firebase Auth Functions
        let currentUser = null;
        const ADMIN_EMAIL = 'cungbocap306@gmail.com';
        let editingFolderIndex = -1;
        let editingAccountIndex = -1;
        let currentAdminFolderIndex = -1;
        let confirmCallback = null;

        // Custom Alert Modal
        function showAlert(title, message, type = 'info') {
            const modal = document.getElementById('alertModal');
            const iconDiv = document.getElementById('alertIcon');
            const titleEl = document.getElementById('alertTitle');
            const messageEl = document.getElementById('alertMessage');

            titleEl.textContent = title;
            messageEl.textContent = message;

            // Set icon based on type
            iconDiv.className = 'w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4';
            if (type === 'success') {
                iconDiv.classList.add('bg-green-100');
                iconDiv.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>';
            } else if (type === 'error') {
                iconDiv.classList.add('bg-red-100');
                iconDiv.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>';
            } else if (type === 'warning') {
                iconDiv.classList.add('bg-yellow-100');
                iconDiv.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-yellow-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" /></svg>';
            } else {
                iconDiv.classList.add('bg-blue-100');
                iconDiv.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>';
            }

            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeAlertModal() {
            const modal = document.getElementById('alertModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        // Custom Confirm Modal
        function showConfirm(title, message, onConfirm) {
            const modal = document.getElementById('confirmModal');
            const titleEl = document.getElementById('confirmTitle');
            const messageEl = document.getElementById('confirmMessage');

            titleEl.textContent = title;
            messageEl.textContent = message;
            confirmCallback = onConfirm;

            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeConfirmModal(confirmed) {
            const modal = document.getElementById('confirmModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');

            if (confirmed && confirmCallback) {
                confirmCallback();
            }
            confirmCallback = null;
        }

        function openAuthModal() {
            const authModal = document.getElementById('authModal');
            authModal.classList.remove('hidden');
            authModal.classList.add('flex');
            switchAuthTab('login');
        }

        function closeAuthModal() {
            const authModal = document.getElementById('authModal');
            authModal.classList.add('hidden');
            authModal.classList.remove('flex');
            clearAuthErrors();
        }

        function switchAuthTab(tab) {
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            const loginTab = document.getElementById('loginTab');
            const registerTab = document.getElementById('registerTab');

            clearAuthErrors();

            if (tab === 'login') {
                loginForm.classList.remove('hidden');
                registerForm.classList.add('hidden');
                loginTab.classList.add('text-indigo-600', 'border-indigo-600', 'border-b-2');
                loginTab.classList.remove('text-gray-500');
                registerTab.classList.remove('text-indigo-600', 'border-indigo-600', 'border-b-2');
                registerTab.classList.add('text-gray-500');
            } else {
                loginForm.classList.add('hidden');
                registerForm.classList.remove('hidden');
                registerTab.classList.add('text-indigo-600', 'border-indigo-600', 'border-b-2');
                registerTab.classList.remove('text-gray-500');
                loginTab.classList.remove('text-indigo-600', 'border-indigo-600', 'border-b-2');
                loginTab.classList.add('text-gray-500');
            }
        }

        function clearAuthErrors() {
            document.getElementById('loginError').classList.add('hidden');
            document.getElementById('registerError').classList.add('hidden');
            document.getElementById('loginEmail').classList.remove('border-red-500');
            document.getElementById('loginPassword').classList.remove('border-red-500');
            document.getElementById('registerEmail').classList.remove('border-red-500');
            document.getElementById('registerPassword').classList.remove('border-red-500');
            document.getElementById('registerPasswordConfirm').classList.remove('border-red-500');
        }

        function showError(elementId, message) {
            const errorEl = document.getElementById(elementId);
            errorEl.textContent = message;
            errorEl.classList.remove('hidden');
        }

        async function handleLogin() {
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;
            const loginBtn = document.getElementById('loginBtn');
            const loginError = document.getElementById('loginError');

            clearAuthErrors();

            if (!email || !password) {
                showError('loginError', 'Vui lòng điền đầy đủ thông tin');
                return;
            }

            loginBtn.disabled = true;
            loginBtn.textContent = 'Đang đăng nhập...';

            try {
                await window.firebaseSignIn(window.firebaseAuth, email, password);
                closeAuthModal();
                // checkAuthState() will be triggered automatically by onAuthStateChanged
            } catch (error) {
                loginBtn.disabled = false;
                loginBtn.textContent = 'Đăng nhập';

                let errorMessage = 'Đăng nhập thất bại. Vui lòng thử lại.';
                if (error.code === 'auth/user-not-found') {
                    errorMessage = 'Email không tồn tại.';
                } else if (error.code === 'auth/wrong-password') {
                    errorMessage = 'Mật khẩu không đúng.';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Email không hợp lệ.';
                } else if (error.code === 'auth/too-many-requests') {
                    errorMessage = 'Quá nhiều lần thử. Vui lòng thử lại sau.';
                }
                showError('loginError', errorMessage);
                document.getElementById('loginEmail').classList.add('border-red-500');
                document.getElementById('loginPassword').classList.add('border-red-500');
            }
        }

        async function handleRegister() {
            const email = document.getElementById('registerEmail').value.trim();
            const password = document.getElementById('registerPassword').value;
            const passwordConfirm = document.getElementById('registerPasswordConfirm').value;
            const registerBtn = document.getElementById('registerBtn');
            const registerError = document.getElementById('registerError');

            clearAuthErrors();

            if (!email || !password || !passwordConfirm) {
                showError('registerError', 'Vui lòng điền đầy đủ thông tin');
                return;
            }

            if (password.length < 6) {
                showError('registerError', 'Mật khẩu phải có ít nhất 6 ký tự');
                document.getElementById('registerPassword').classList.add('border-red-500');
                return;
            }

            if (password !== passwordConfirm) {
                showError('registerError', 'Mật khẩu xác nhận không khớp');
                document.getElementById('registerPassword').classList.add('border-red-500');
                document.getElementById('registerPasswordConfirm').classList.add('border-red-500');
                return;
            }

            registerBtn.disabled = true;
            registerBtn.textContent = 'Đang đăng ký...';

            try {
                await window.firebaseSignUp(window.firebaseAuth, email, password);
                closeAuthModal();
                // checkAuthState() will be triggered automatically by onAuthStateChanged
            } catch (error) {
                registerBtn.disabled = false;
                registerBtn.textContent = 'Đăng ký';

                let errorMessage = 'Đăng ký thất bại. Vui lòng thử lại.';
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage = 'Email đã được sử dụng. Vui lòng đăng nhập.';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Email không hợp lệ.';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = 'Mật khẩu quá yếu.';
                }
                showError('registerError', errorMessage);
                document.getElementById('registerEmail').classList.add('border-red-500');
            }
        }

        async function handleLogout() {
            try {
                await window.firebaseSignOut(window.firebaseAuth);
                // checkAuthState() will be triggered automatically by onAuthStateChanged
            } catch (error) {
                console.error('Logout error:', error);
                showAlert('Lỗi', 'Đăng xuất thất bại. Vui lòng thử lại.', 'error');
            }
        }

        async function forgotPassword() {
            const email = document.getElementById('loginEmail').value.trim();
            if (!email) {
                showAlert('Thông báo', 'Vui lòng nhập email để khôi phục mật khẩu', 'warning');
                return;
            }

            try {
                await window.firebaseSendPasswordReset(window.firebaseAuth, email);
                showAlert('Thành công', 'Email khôi phục mật khẩu đã được gửi! Vui lòng kiểm tra hộp thư của bạn.', 'success');
            } catch (error) {
                let errorMessage = 'Không thể gửi email khôi phục.';
                if (error.code === 'auth/user-not-found') {
                    errorMessage = 'Email không tồn tại trong hệ thống.';
                }
                showAlert('Lỗi', errorMessage, 'error');
            }
        }

        function isAdmin() {
            return currentUser && currentUser.email === ADMIN_EMAIL;
        }

        function checkAuthState() {
            window.firebaseOnAuthStateChanged(window.firebaseAuth, (user) => {
                currentUser = user;
                const landingPage = document.getElementById('landingPage');
                const mainApp = document.getElementById('mainApp');
                const userEmail = document.getElementById('userEmail');
                const adminBtn = document.getElementById('adminBtn');
                const loginBtn = document.getElementById('headerLoginBtn');
                const logoutBtn = document.getElementById('logoutBtn');

                if (user) {
                    // User is signed in
                    landingPage.classList.add('hidden');
                    mainApp.classList.remove('hidden');
                    if (userEmail) {
                        userEmail.textContent = `Xin chào, ${user.email}`;
                    }
                    if (loginBtn) loginBtn.classList.add('hidden');
                    if (logoutBtn) logoutBtn.classList.remove('hidden');

                    // Show admin button if user is admin
                    if (adminBtn) {
                        if (isAdmin()) {
                            adminBtn.classList.remove('hidden');
                        } else {
                            adminBtn.classList.add('hidden');
                        }
                    }
                } else {
                    // Guest user (modify logic to show main app)
                    landingPage.classList.add('hidden'); // Ensure landing page is hidden
                    mainApp.classList.remove('hidden'); // Show main app directly

                    if (userEmail) {
                        userEmail.textContent = 'Khách (Chế độ xem)';
                    }

                    if (loginBtn) loginBtn.classList.remove('hidden');
                    if (logoutBtn) logoutBtn.classList.add('hidden');
                    if (adminBtn) adminBtn.classList.add('hidden');
                }

                // Always load data
                loadDataFromStorage().then(() => {
                    setupDataListener();
                    setTimeout(() => {
                        if (currentFolderIndex === -1) showFolders();
                    }, 100);
                });
            });
        }

        // Initialize auth check when Firebase is ready
        setTimeout(() => {
            if (window.firebaseAuth && window.firebaseOnAuthStateChanged) {
                checkAuthState();
            }
        }, 1000);

        // Allow Enter key to submit forms
        document.addEventListener('DOMContentLoaded', () => {
            const loginEmail = document.getElementById('loginEmail');
            const loginPassword = document.getElementById('loginPassword');
            const registerEmail = document.getElementById('registerEmail');
            const registerPassword = document.getElementById('registerPassword');
            const registerPasswordConfirm = document.getElementById('registerPasswordConfirm');

            if (loginEmail && loginPassword) {
                loginPassword.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') handleLogin();
                });
            }

            if (registerPasswordConfirm) {
                registerPasswordConfirm.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') handleRegister();
                });
            }
        });

        let DATA = [
            {
                id: 'chatgpt-go', name: "CHAT GPT GO", icon: `<img src="https://sf-static.upanhlaylink.com/img/image_20251206a747b4284acd312266df6c38d026cf9c.jpg" alt="ChatGPT Go" class="w-full h-full rounded-full object-cover border-2 border-white/50">`,
                notes: ["Tài khoản dùng chung", "Không đổi mật khẩu"],
                accounts: [
                    { name: "GPT Go 1", username: "go1@daothaihai.qzz.io", password: "H123456789012", secret: "3VSIENKIPSI4M44D6SQPW7UXUYK66H5E", showOtp: true },
                    { name: "GPT Go 2", username: "go2@daothaihai.qzz.io", password: "H123456789012", secret: "VR5FVI55KWJ3YBYCKSYY4QXGQTKSSU2T", showOtp: true },
                    { name: "GPT Go 3", username: "go3@daothaihai.qzz.io", password: "H123456789012", secret: "6KIJPTAOKGXGH4V4TKUGRYZRSAGAZLVO", showOtp: true },
                    { name: "GPT Go 4", username: "go4@daothaihai.qzz.io", password: "H123456789012", secret: "4332MUZWJBGG2T26EBO3B6F3G2AYQBLO", showOtp: true },
                    { name: "GPT Go 5", username: "go5@daothaihai.qzz.io", password: "H123456789012", secret: "HDKKSHQLZJOL2FT2HYD5U7ADIVVB75DG", showOtp: true },
                    { name: "GPT Go 6", username: "go6@daothaihai.qzz.io", password: "H123456789012", secret: "YWFIJ63MUFGYAWYPGQTBBRVGVSZXJZBU", showOtp: true },
                    { name: "GPT Go 7", username: "go7@daothaihai.qzz.io", password: "H123456789012", secret: "IEO3CAY5X4C54WYYRYTI2RFHREP77SAN", showOtp: true }
                ]
            },
            {
                id: 'chatgpt', name: "CHAT GPT PLUS", maintenance: true, icon: `<img src="https://sf-static.upanhlaylink.com/img/image_20251206a747b4284acd312266df6c38d026cf9c.jpg" alt="ChatGPT" class="w-full h-full rounded-full object-cover grayscale border-2 border-white/50">`,
                notes: [], accounts: []
            },
            {
                id: 'capcut', name: "CAPCUT PRO", icon: `<img src="https://sf-static.upanhlaylink.com/img/image_2025120621c345d39762430df4652d172b019245.jpg" alt="CapCut" class="w-full h-full rounded-full object-cover border-2 border-white/50">`,
                notes: ["Không đăng xuất thiết bị khác"],
                accounts: [
                    { name: "CapCut 1", username: "pro1.dth@yopmail.com", password: "H1234567890", secret: "HXDMVJECJJWSRB3HWIZR4IFUGFTMXBOZ", showOtp: true },
                    { name: "CapCut 2", username: "pro2.dth@yopmail.com", password: "H1234567890", secret: "HXDMVJECJJWSRB3HWIZR4IFUGFTMXBOZ", showOtp: true }
                ]
            },
            {
                id: 'studocu', name: "STUDOCU PREMIUM", icon: `<img src="https://sf-static.upanhlaylink.com/img/image_20251206b36cdc7ce5265c711f4602636e1b786b.jpg" alt="Studocu" class="w-full h-full rounded-full object-cover border-2 border-white/50">`,
                notes: ["Tài khoản dùng chung", "Không đổi mật khẩu"],
                accounts: [
                    { name: "Studocu 1", username: "caocaomuoi@2200freefonts.com", password: "H1234567890", secret: "", showOtp: false }
                ]
            },
        ];

        let dataListener = null;

        async function saveDataToStorage() {
            try {
                // Lưu vào localStorage như backup
                localStorage.setItem('trada_data', JSON.stringify(DATA));
                console.log('Saved to localStorage');

                // Lưu vào Firestore để đồng bộ cho tất cả người dùng
                if (window.firebaseDb && window.firebaseDoc && window.firebaseSetDoc) {
                    try {
                        const dataRef = window.firebaseDoc(window.firebaseDb, 'app_data', 'main');
                        await window.firebaseSetDoc(dataRef, {
                            data: DATA,
                            updatedAt: new Date().toISOString()
                        }, { merge: true });
                        console.log('Saved to Firestore successfully');
                    } catch (firestoreError) {
                        console.error('Error saving to Firestore:', firestoreError);
                        const errorMsg = firestoreError.message || firestoreError.toString();
                        // Nếu bị chặn, throw error để hiển thị thông báo
                        if (errorMsg.includes('ERR_BLOCKED_BY_CLIENT') || errorMsg.includes('blocked')) {
                            throw new Error('ERR_BLOCKED_BY_CLIENT');
                        }
                        // Nếu API chưa được bật
                        if (errorMsg.includes('permission-denied') || errorMsg.includes('API has not been used') || errorMsg.includes('not been enabled')) {
                            throw new Error('FIRESTORE_API_NOT_ENABLED');
                        }
                        // Với các lỗi khác, chỉ log và tiếp tục
                    }
                } else {
                    console.warn('Firestore not available for saving');
                }
            } catch (e) {
                console.error('Error saving data:', e);
                throw e; // Re-throw để forceSyncToFirestore có thể bắt
            }
        }

        async function loadDataFromStorage() {
            try {
                // Ưu tiên load từ Firestore
                if (window.firebaseDb && window.firebaseDoc && window.firebaseGetDoc) {
                    try {
                        const dataRef = window.firebaseDoc(window.firebaseDb, 'app_data', 'main');
                        const docSnap = await window.firebaseGetDoc(dataRef);

                        if (docSnap.exists()) {
                            const firestoreData = docSnap.data();
                            if (firestoreData.data && Array.isArray(firestoreData.data)) {
                                console.log('Loaded data from Firestore:', firestoreData.data.length, 'folders');
                                DATA = firestoreData.data;
                                // Ensure showOtp property exists for all accounts
                                DATA.forEach(folder => {
                                    if (folder.accounts) {
                                        folder.accounts.forEach(acc => {
                                            if (acc.showOtp === undefined) acc.showOtp = true;
                                        });
                                    }
                                    // Migration for ChatGPT Go note (preserve existing hardcoded note)
                                    if (folder.id === 'chatgpt-go' && (!folder.categoryNotes || folder.categoryNotes.length === 0)) {
                                        folder.categoryNotes = ["Tài khoản nếu bị hết lượng dùng thì vào tài khoản khác nha"];
                                    }
                                });
                                // Cập nhật localStorage với dữ liệu mới nhất
                                localStorage.setItem('trada_data', JSON.stringify(DATA));
                                return;
                            }
                        } else {
                            console.log('No data in Firestore, checking localStorage...');
                        }
                    } catch (firestoreError) {
                        console.error('Firestore read error:', firestoreError);
                        const errorMsg = firestoreError.message || firestoreError.toString();
                        if (errorMsg.includes('permission-denied') || errorMsg.includes('API has not been used') || errorMsg.includes('not been enabled')) {
                            console.error('⚠️ Firestore API chưa được bật! Vui lòng bật API trong Google Cloud Console.');
                            if (isAdmin()) {
                                console.log('🔗 Link bật API: https://console.developers.google.com/apis/api/firestore.googleapis.com/overview?project=trada3k-c402a');
                            }
                        }
                        // Continue to localStorage fallback
                    }
                } else {
                    console.log('Firestore not available, using localStorage...');
                }

                // Fallback: load từ localStorage nếu Firestore chưa có dữ liệu
                const saved = localStorage.getItem('trada_data');
                if (saved) {
                    console.log('Loaded data from localStorage');
                    DATA = JSON.parse(saved);
                    // Ensure showOtp property exists for all accounts
                    DATA.forEach(folder => {
                        if (folder.accounts) {
                            folder.accounts.forEach(acc => {
                                if (acc.showOtp === undefined) acc.showOtp = true;
                            });
                        }
                    });
                    // Upload lên Firestore nếu chưa có (chỉ admin mới upload)
                    if (window.firebaseDb && isAdmin()) {
                        console.log('Admin detected, uploading to Firestore...');
                        saveDataToStorage();
                    }
                } else {
                    console.log('No data found in localStorage either');
                }
            } catch (e) {
                console.error('Error loading data:', e);
                // Fallback to localStorage on error
                try {
                    const saved = localStorage.getItem('trada_data');
                    if (saved) {
                        DATA = JSON.parse(saved);
                    }
                } catch (e2) {
                    console.error('Error loading from localStorage:', e2);
                }
            }
        }

        function setupDataListener() {
            // Hủy listener cũ nếu có
            if (dataListener) {
                dataListener();
                dataListener = null;
            }

            // Thiết lập real-time listener để tự động cập nhật khi admin thay đổi
            if (window.firebaseDb && window.firebaseDoc && window.firebaseOnSnapshot) {
                try {
                    const dataRef = window.firebaseDoc(window.firebaseDb, 'app_data', 'main');
                    console.log('Setting up Firestore real-time listener...');
                    dataListener = window.firebaseOnSnapshot(dataRef, (docSnap) => {
                        if (docSnap.exists()) {
                            const firestoreData = docSnap.data();
                            if (firestoreData.data && Array.isArray(firestoreData.data)) {
                                console.log('Data updated from Firestore:', firestoreData.data.length, 'folders');
                                DATA = firestoreData.data;
                                // Ensure showOtp property exists for all accounts
                                DATA.forEach(folder => {
                                    if (folder.accounts) {
                                        folder.accounts.forEach(acc => {
                                            if (acc.showOtp === undefined) acc.showOtp = true;
                                        });
                                    }
                                });
                                // Cập nhật localStorage
                                localStorage.setItem('trada_data', JSON.stringify(DATA));
                                // Refresh UI
                                if (currentFolderIndex === -1) {
                                    showFolders();
                                } else {
                                    actuallyOpenFolder(currentFolderIndex);
                                }
                                // Nếu đang ở admin modal, refresh luôn
                                if (document.getElementById('adminModal') && !document.getElementById('adminModal').classList.contains('hidden')) {
                                    loadAdminFolders();
                                    if (currentAdminFolderIndex !== -1) {
                                        loadAccountsForAdmin();
                                    }
                                }
                            }
                        } else {
                            console.log('No data in Firestore snapshot');
                        }
                    }, (error) => {
                        console.error('Error listening to data changes:', error);
                        const errorMsg = error.message || error.toString();
                        if (errorMsg.includes('permission-denied') || errorMsg.includes('Missing or insufficient permissions')) {
                            console.warn('⚠️ Firestore Permission Error: Data sync for guests requires "allow read: if true" in Firestore Rules.');
                            if (isAdmin()) {
                                showAlert('Cảnh báo hệ thống', 'Dữ liệu không đồng bộ được cho khách do thiếu quyền đọc.\nVui lòng cập nhật Firestore Rules.', 'warning');
                            }
                        }
                    });
                } catch (error) {
                    console.error('Error setting up listener:', error);
                }
            } else {
                console.warn('Firestore not available for real-time updates');
            }
        }

        // DOM Elements
        const listContainer = document.getElementById('listContainer');
        const listTitle = document.getElementById('listTitle');
        const navBar = document.getElementById('navBar');
        const currentFolderNameEl = document.getElementById('currentFolderName');
        const headerSubtitle = document.getElementById('headerSubtitle');
        const disclaimerModal = document.getElementById('disclaimerModal');
        const disclaimerList = document.getElementById('disclaimerList');
        const confirmBtn = document.getElementById('confirmBtn');
        const instructionModal = document.getElementById('instructionModal');
        const homeFooter = document.getElementById('homeFooter');
        const landingPage = document.getElementById('landingPage');
        const extraHeaderContent = document.getElementById('extraHeaderContent');
        const capcutGuideModal = document.getElementById('capcutGuideModal');
        const capcutGuideTitle = document.getElementById('capcutGuideTitle');
        const capcutGuideContent = document.getElementById('capcutGuideContent');
        const lastUpdateLabel = document.getElementById('lastUpdateLabel');
        const introSection = document.getElementById('introSection');
        const passwordModal = document.getElementById('passwordModal');
        const modalPasswordInput = document.getElementById('modalPasswordInput');
        const modalLoginError = document.getElementById('modalLoginError');

        let currentFolderIndex = -1;
        let currentAccountIndex = -1;
        let pendingFolderIndex = -1;
        let disclaimerTimer = null;

        function startApp() {
            // This function is now handled by Firebase auth
            // Only show app if user is authenticated
            if (currentUser) {
                landingPage.style.animation = 'fadeOut 0.3s ease-out';
                setTimeout(() => {
                    landingPage.classList.add('hidden');
                    mainApp.classList.remove('hidden');
                    mainApp.style.animation = 'fadeIn 0.4s ease-out';
                    setTimeout(() => {
                        showFolders();
                    }, 100);
                }, 300);
            } else {
                openAuthModal();
            }
        }

        function copyText(text, btnElement) {
            const el = document.createElement('textarea'); el.value = text; document.body.appendChild(el); el.select(); document.execCommand('copy'); document.body.removeChild(el);
            if (btnElement) {
                const original = btnElement.innerHTML;
                btnElement.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>`;
                setTimeout(() => btnElement.innerHTML = original, 1000);
            }
        }

        function openInstructions() { instructionModal.classList.remove('hidden'); instructionModal.classList.add('flex'); }
        function closeInstructions() { instructionModal.classList.add('hidden'); instructionModal.classList.remove('flex'); }

        function openCapcutGuide(type) {
            capcutGuideModal.classList.remove('hidden'); capcutGuideModal.classList.add('flex');
            if (type === 'mobile') {
                capcutGuideTitle.textContent = "Hướng dẫn đăng nhập (Mobile)";
                capcutGuideContent.innerHTML = `
                    <ol class="list-decimal pl-5 space-y-2 marker:text-indigo-600 marker:font-bold">
                        <li>Mở ứng dụng <strong>CapCut</strong> trên điện thoại.</li>
                        <li>Chọn mục <strong>Tôi (Profile)</strong> ở góc dưới cùng bên phải.</li>
                        <li>Chọn <strong>Đăng nhập bằng Email</strong>.</li>
                        <li>Nhập tài khoản & mật khẩu từ danh sách.</li>
                        <li>Nếu hệ thống yêu cầu mã xác minh, quay lại đây và lấy mã 6 số.</li>
                    </ol>
                    <div class="mt-3 p-3 bg-yellow-50 text-yellow-700 text-xs rounded border border-yellow-100"><strong>Lưu ý:</strong> Tuyệt đối không đăng xuất các thiết bị khác trong tài khoản.</div>`;
            } else {
                capcutGuideTitle.textContent = "Hướng dẫn đăng nhập (PC)";
                capcutGuideContent.innerHTML = `
                    <ol class="list-decimal pl-5 space-y-2 marker:text-blue-600 marker:font-bold">
                        <li>Mở phần mềm <strong>CapCut</strong> trên máy tính.</li>
                        <li>Click vào biểu tượng <strong>Avatar</strong> ở góc trên cùng bên trái.</li>
                        <li>Chọn nút <strong>Sign in</strong> (Đăng nhập).</li>
                        <li>Chọn tiếp <strong>Sign in with Email</strong>.</li>
                        <li>Nhập Email và Mật khẩu, sau đó nhập mã 2FA từ web này nếu được hỏi.</li>
                    </ol>`;
            }
        }
        function closeCapcutGuide() { capcutGuideModal.classList.add('hidden'); capcutGuideModal.classList.remove('flex'); }

        function openPasswordModal(index) {
            pendingFolderIndex = index;
            modalLoginError.classList.add('hidden');
            modalPasswordInput.value = '';
            modalPasswordInput.classList.remove('border-red-500', 'shake');
            passwordModal.classList.remove('hidden'); passwordModal.classList.add('flex');
            setTimeout(() => modalPasswordInput.focus(), 100);
        }

        function closePasswordModal() {
            passwordModal.classList.add('hidden'); passwordModal.classList.remove('flex');
            pendingFolderIndex = -1;
        }

        function checkModalAutoLogin() {
            const val = modalPasswordInput.value;
            modalLoginError.classList.add('hidden');
            modalPasswordInput.classList.remove('border-red-500', 'shake');
            if (val.length === 4) {
                if (val === '3066') {
                    passwordModal.classList.add('hidden'); passwordModal.classList.remove('flex');
                    tryOpenFolder(pendingFolderIndex);
                } else {
                    modalLoginError.classList.remove('hidden'); modalPasswordInput.classList.add('border-red-500', 'shake'); setTimeout(() => { modalPasswordInput.classList.remove('shake'); }, 500);
                }
            }
        }

        function checkModalPassword() {
            const val = modalPasswordInput.value;
            if (val === '3066') {
                passwordModal.classList.add('hidden'); passwordModal.classList.remove('flex');
                tryOpenFolder(pendingFolderIndex);
            } else {
                modalLoginError.classList.remove('hidden'); modalPasswordInput.classList.add('border-red-500', 'shake'); modalPasswordInput.value = ''; modalPasswordInput.focus(); setTimeout(() => { modalPasswordInput.classList.remove('shake'); }, 500);
            }
        }

        function showFolders() {
            currentFolderIndex = -1; currentAccountIndex = -1;
            if (navBar) navBar.classList.add('hidden');
            if (extraHeaderContent) extraHeaderContent.classList.add('hidden');
            if (homeFooter) homeFooter.classList.remove('hidden');
            if (listTitle) listTitle.textContent = "DANH MỤC TÀI KHOẢN";
            if (headerSubtitle) headerSubtitle.textContent = "Chọn danh mục để xem";
            if (lastUpdateLabel) lastUpdateLabel.classList.remove('hidden');
            if (introSection) introSection.classList.remove('hidden');
            const contactSection = document.getElementById('contactSection');
            if (contactSection) contactSection.classList.remove('hidden');

            listContainer.innerHTML = '';
            listContainer.className = "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 fade-in pb-2";

            DATA.forEach((folder, index) => {
                // Bỏ qua danh mục bị ẩn (trừ khi là admin)
                if (folder.hidden && !isAdmin()) {
                    return;
                }

                const btn = document.createElement('button');
                btn.className = `w-full text-left p-3 card flex items-center gap-3 group text-gray-800`;

                if (folder.maintenance) { btn.onclick = () => showAlert("Thông báo", "Đang bảo trì nha người đẹp, người đẹp quay lại sau nhé!", 'warning'); btn.classList.add('opacity-60'); }
                else if (folder.type === 'link') { btn.onclick = () => window.open(folder.url, '_blank'); btn.classList.add('bg-gradient-to-br', 'from-indigo-50', 'to-purple-50'); }
                else { btn.onclick = () => tryOpenFolder(index); }

                let subtitle = folder.maintenance ? "Đang bảo trì" : (folder.type === 'link' ? "Truy cập ngay" : `${folder.accounts.length} tài khoản`);
                let iconBgClass = "w-10 h-10 rounded-xl flex items-center justify-center overflow-hidden bg-gradient-to-br from-indigo-500/10 to-purple-500/10 flex-shrink-0";
                let badge = `<span class="ml-2 bg-gradient-to-r from-green-400 to-emerald-500 text-white text-[9px] px-2 py-0.5 rounded-full font-bold flex-shrink-0 shadow-sm tracking-wide">MIỄN PHÍ</span>`;

                btn.innerHTML = `
                    <div class="${iconBgClass}">${folder.icon}</div>
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center"><span class="font-bold text-gray-800 text-sm group-hover:text-indigo-700 truncate">${folder.name}</span>${badge}</div>
                        <div class="text-[10px] text-gray-500 font-medium truncate">${subtitle}</div>
                    </div>
                    <svg class="w-4 h-4 text-gray-400 group-hover:text-indigo-500 transition-all flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>
                `;
                listContainer.appendChild(btn);
            });
        }

        function tryOpenFolder(index) {
            pendingFolderIndex = index; const folder = DATA[index];
            disclaimerList.innerHTML = '';
            (folder.notes || []).forEach(note => {
                const li = document.createElement('li'); li.className = "flex items-start gap-2"; li.innerHTML = `<span class="text-red-500 font-bold">•</span><span>${note}</span>`; disclaimerList.appendChild(li);
            });
            disclaimerModal.classList.remove('hidden'); disclaimerModal.classList.add('flex');

            let timeLeft = isAdmin() ? 0 : 3;

            if (timeLeft > 0) {
                confirmBtn.disabled = true;
                confirmBtn.className = "mt-6 w-full bg-gray-400 text-white font-semibold py-3 rounded-xl transition-all cursor-not-allowed";
                confirmBtn.textContent = `Vui lòng chờ ${timeLeft}s...`;
            } else {
                confirmBtn.disabled = false;
                confirmBtn.className = "mt-6 w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold py-3 rounded-xl hover:from-indigo-700 hover:to-purple-700 transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5";
                confirmBtn.textContent = "Đã hiểu & Tiếp tục";
            }

            if (disclaimerTimer) clearInterval(disclaimerTimer);
            if (timeLeft > 0) {
                disclaimerTimer = setInterval(() => {
                    timeLeft--;
                    if (timeLeft > 0) confirmBtn.textContent = `Vui lòng chờ ${timeLeft}s...`;
                    else {
                        clearInterval(disclaimerTimer); confirmBtn.disabled = false; confirmBtn.className = "mt-6 w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold py-3 rounded-xl hover:from-indigo-700 hover:to-purple-700 transition-all shadow-lg hover:shadow-xl transform hover:-translate-y-0.5"; confirmBtn.textContent = "Đã hiểu & Tiếp tục";
                    }
                }, 1000);
            }
        }

        function confirmDisclaimer() {
            disclaimerModal.classList.add('hidden'); disclaimerModal.classList.remove('flex');
            if (pendingFolderIndex !== -1) actuallyOpenFolder(pendingFolderIndex);
        }

        function actuallyOpenFolder(index) {
            currentFolderIndex = index; currentAccountIndex = -1;
            const folder = DATA[index];
            navBar.classList.remove('hidden'); homeFooter.classList.add('hidden');
            introSection.classList.add('hidden');
            const contactSection = document.getElementById('contactSection');
            if (contactSection) contactSection.classList.add('hidden');
            listTitle.textContent = `DANH SÁCH TÀI KHOẢN`; headerSubtitle.textContent = folder.name;

            if (lastUpdateLabel) lastUpdateLabel.classList.add('hidden');

            extraHeaderContent.innerHTML = '';
            extraHeaderContent.classList.remove('hidden');

            let extraHtml = `
                <a href="https://facebook.com/DTH.3006" target="_blank" class="bg-white w-fit mx-auto mb-4 flex items-center justify-center gap-2 py-3 px-6 text-indigo-700 rounded-xl text-sm font-bold shadow-sm border border-indigo-100 hover:shadow-md transition-all group">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 group-hover:scale-110 transition-transform" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
                    </svg>
                    Bấm vào đây để liên hệ Admin
                </a>
            `;

            if (folder.id === 'capcut') {
                extraHtml += `
                    <div class="grid grid-cols-2 gap-3 fade-in">
                        <button onclick="openCapcutGuide('mobile')" class="flex items-center justify-center gap-2 py-3 px-4 bg-gradient-to-r from-indigo-50 to-purple-50 text-indigo-700 rounded-xl text-xs font-semibold border border-indigo-200 hover:from-indigo-100 hover:to-purple-100 transition-all shadow-sm hover:shadow-md"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" /></svg> HD Đăng nhập ĐT</button>
                        <button onclick="openCapcutGuide('pc')" class="flex items-center justify-center gap-2 py-3 px-4 bg-gradient-to-r from-blue-50 to-cyan-50 text-blue-700 rounded-xl text-xs font-semibold border border-blue-200 hover:from-blue-100 hover:to-cyan-100 transition-all shadow-sm hover:shadow-md"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" /></svg> HD Đăng nhập PC</button>
                    </div>`;
            }

            extraHeaderContent.innerHTML = extraHtml;

            listContainer.innerHTML = '';
            listContainer.innerHTML = '';
            listContainer.className = "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 fade-in pb-2";

            if (folder.categoryNotes && folder.categoryNotes.length > 0) {
                folder.categoryNotes.forEach(note => {
                    const noteDiv = document.createElement('div');
                    noteDiv.className = "mb-3 md:col-span-full p-4 text-center text-sm font-medium text-indigo-800 bg-indigo-50 rounded-xl border-l-4 border-indigo-500 shadow-sm";
                    noteDiv.innerHTML = `💡 ${note}`;
                    listContainer.appendChild(noteDiv);
                });
            }

            folder.accounts.forEach((acc, accIndex) => {
                // Bỏ qua tài khoản bị ẩn (trừ khi là admin)
                if (acc.hidden && !isAdmin()) {
                    return;
                }

                const hiddenLabel = (acc.hidden && isAdmin()) ? '<span class="text-red-500 text-xs ml-2 font-bold">(Đang ẩn)</span>' : '';

                const btn = document.createElement('button');
                btn.className = `w-full text-left px-5 py-4 rounded-xl card flex items-center gap-4 group focus:outline-none focus:ring-2 focus:ring-indigo-500 relative transition-transform hover:-translate-y-1`;
                btn.onclick = () => selectAccount(accIndex);
                btn.innerHTML = `
                    <div class="w-12 h-12 rounded-xl overflow-hidden flex-shrink-0 bg-gray-50 border border-gray-100 group-hover:border-indigo-300 transition-colors shadow-sm flex items-center justify-center">
                        ${folder.icon}
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="acc-name font-medium text-gray-700 group-hover:text-gray-900 truncate">${acc.name}${hiddenLabel}</div>
                        <div class="acc-user text-xs text-gray-500 truncate font-mono">${acc.username}</div>
                    </div>
                    <svg class="w-5 h-5 text-gray-400 group-hover:text-indigo-600 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                `;
                listContainer.appendChild(btn);
            });
        }

        function selectAccount(accIndex) {
            if (currentFolderIndex === -1) return;
            const folder = DATA[currentFolderIndex];
            if (!folder || !folder.accounts[accIndex]) return;

            const acc = folder.accounts[accIndex];
            currentAccountIndex = accIndex;

            // Populate Modal
            const iconDiv = document.getElementById('modalAccountIcon');
            iconDiv.innerHTML = folder.icon.replace('w-14 h-14', 'w-full h-full'); // Adjust icon size if needed

            document.getElementById('modalAccountName').textContent = acc.name;
            document.getElementById('modalAccountSubtitle').textContent = acc.username;

            document.getElementById('modalAccountUsername').value = acc.username;
            document.getElementById('modalAccountPassword').value = acc.password;

            const otpSection = document.getElementById('modalOtpSection');
            const adminControls = document.getElementById('modalAdminControls');

            // OTP Logic
            const shouldShowOtp = acc.showOtp !== false && acc.secret && acc.secret.trim() !== '';
            if (shouldShowOtp) {
                otpSection.classList.remove('hidden');
                updateOTP(); // Initial update
            } else {
                otpSection.classList.add('hidden');
            }

            // Admin Controls
            if (isAdmin()) {
                adminControls.classList.remove('hidden');
                adminControls.innerHTML = `
                        <button onclick="closeAccountDetailModal(); editAccount(${currentFolderIndex}, ${accIndex})" class="flex-1 bg-indigo-50 text-indigo-700 px-3 py-2.5 rounded-lg text-sm font-semibold hover:bg-indigo-100 transition-colors flex items-center justify-center gap-1 border border-indigo-200">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                            </svg>
                            Sửa
                        </button>
                        <button onclick="closeAccountDetailModal(); deleteAccount(${currentFolderIndex}, ${accIndex})" class="flex-1 bg-red-50 text-red-700 px-3 py-2.5 rounded-lg text-sm font-semibold hover:bg-red-100 transition-colors flex items-center justify-center gap-1 border border-red-200">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                            Xóa
                        </button>
                    `;
            } else {
                adminControls.classList.add('hidden');
            }

            // Show Modal
            const modal = document.getElementById('accountDetailModal');
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeAccountDetailModal() {
            const modal = document.getElementById('accountDetailModal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            currentAccountIndex = -1;
        }

        function copyToClipboardText(text, btnElement) {
            const el = document.createElement('textarea'); el.value = text; document.body.appendChild(el); el.select(); document.execCommand('copy'); document.body.removeChild(el);
            if (btnElement) {
                const original = btnElement.innerHTML;
                btnElement.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>`;
                setTimeout(() => btnElement.innerHTML = original, 1000);
            }
        }

        const circumference = 113.1; // 2 * PI * 18

        function updateLoop() {
            const epoch = Math.round(new Date().getTime() / 1000.0); const countDown = 30 - (epoch % 30);

            // Only update if modal is active
            const modal = document.getElementById('accountDetailModal');
            if (modal && !modal.classList.contains('hidden') && currentAccountIndex !== -1) {
                const acc = DATA[currentFolderIndex].accounts[currentAccountIndex];
                if (acc && acc.showOtp !== false && acc.secret && acc.secret.trim() !== '') {
                    updateOTP(); // Refresh code if needed

                    const ring = document.getElementById('modalTimerRing');
                    const text = document.getElementById('modalTimerText');
                    if (ring && text) {
                        text.textContent = countDown;
                        const offset = circumference - ((countDown / 30) * 100 / 100) * circumference;
                        ring.style.strokeDashoffset = offset;
                        if (countDown <= 5) { ring.style.stroke = "#ef4444"; text.classList.add('text-red-600'); }
                        else { ring.style.stroke = "#4f46e5"; text.classList.remove('text-red-600'); }
                    }
                }
            }
        }

        function updateOTP() {
            if (currentFolderIndex === -1 || currentAccountIndex === -1) return;
            const acc = DATA[currentFolderIndex].accounts[currentAccountIndex];
            const otpDisplay = document.getElementById('modalOtpValue');
            if (otpDisplay) {
                try {
                    const cleanSecret = acc.secret.replace(/\s/g, '').toUpperCase();
                    const totp = new OTPAuth.TOTP({ algorithm: "SHA1", digits: 6, period: 30, secret: OTPAuth.Secret.fromBase32(cleanSecret) });
                    const token = totp.generate();
                    otpDisplay.textContent = token.match(/.{1,3}/g).join(' '); // Format with space
                } catch (e) { otpDisplay.textContent = "LỖI KEY"; }
            }
        }

        // Admin Functions
        function openAdminModal() {
            if (!isAdmin()) {
                showAlert('Thông báo', 'Bạn không có quyền truy cập!', 'warning');
                return;
            }
            const adminModal = document.getElementById('adminModal');
            adminModal.classList.remove('hidden');
            adminModal.classList.add('flex');
            switchAdminTab('folders');
            loadAdminFolders();
        }

        function closeAdminModal() {
            const adminModal = document.getElementById('adminModal');
            adminModal.classList.add('hidden');
            adminModal.classList.remove('flex');
            editingFolderIndex = -1;
            editingAccountIndex = -1;
        }

        function switchAdminTab(tab) {
            const foldersContent = document.getElementById('adminFoldersContent');
            const accountsContent = document.getElementById('adminAccountsContent');
            const foldersTab = document.getElementById('adminFoldersTab');
            const accountsTab = document.getElementById('adminAccountsTab');

            if (tab === 'folders') {
                foldersContent.classList.remove('hidden');
                accountsContent.classList.add('hidden');
                foldersTab.classList.add('text-indigo-600', 'border-b-2', 'border-indigo-600');
                foldersTab.classList.remove('text-gray-500');
                accountsTab.classList.remove('text-indigo-600', 'border-b-2', 'border-indigo-600');
                accountsTab.classList.add('text-gray-500');
            } else {
                foldersContent.classList.add('hidden');
                accountsContent.classList.remove('hidden');
                accountsTab.classList.add('text-indigo-600', 'border-b-2', 'border-indigo-600');
                accountsTab.classList.remove('text-gray-500');
                foldersTab.classList.remove('text-indigo-600', 'border-b-2', 'border-indigo-600');
                foldersTab.classList.add('text-gray-500');
                populateAdminFolderSelect();
                loadAccountsForAdmin();
            }
        }

        function loadAdminFolders() {
            const list = document.getElementById('adminFoldersList');
            list.innerHTML = '';

            DATA.forEach((folder, index) => {
                const div = document.createElement('div');
                const hiddenClass = folder.hidden ? 'opacity-60' : '';
                div.className = `flex items-center justify-between p-4 card mb-3 ${hiddenClass}`;
                div.innerHTML = `
                        <div class="flex items-center gap-3 flex-1">
                        <div class="w-10 h-10 rounded-lg overflow-hidden bg-gradient-to-br from-gray-100 to-gray-200">
                            ${folder.icon}
                        </div>
                        <div class="flex-1">
                            <div class="font-bold text-gray-800 flex items-center gap-2">
                                ${folder.name}
                                ${folder.hidden ? '<span class="text-xs bg-orange-100 text-orange-700 px-2 py-0.5 rounded-full">Đã ẩn</span>' : ''}
                            </div>
                            <div class="text-xs text-gray-500 font-mono mt-0.5">ID: ${folder.id} | ${folder.accounts ? folder.accounts.length : 0} tài khoản</div>
                        </div>
                        ${folder.maintenance ? '<span class="text-xs bg-yellow-100 text-yellow-700 px-2 py-1 rounded-full font-bold">Bảo trì</span>' : ''}
                    </div>
                        <div class="flex gap-2">
                            <button onclick="editFolder(${index})" class="bg-indigo-600 text-white px-3 py-1.5 rounded-lg text-xs font-semibold hover:bg-indigo-700 transition-colors">
                                Sửa
                            </button>
                            <button onclick="deleteFolder(${index})" class="bg-red-600 text-white px-3 py-1.5 rounded-lg text-xs font-semibold hover:bg-red-700 transition-colors">
                                Xóa
                            </button>
                        </div>
                    `;
                list.appendChild(div);
            });
        }

        function openAddFolderModal() {
            editingFolderIndex = -1;
            document.getElementById('folderEditTitle').textContent = 'Thêm danh mục mới';
            document.getElementById('folderNameInput').value = '';
            document.getElementById('folderIdInput').value = '';
            document.getElementById('folderIconInput').value = '';
            document.getElementById('folderMaintenanceInput').checked = false;
            document.getElementById('folderHiddenInput').checked = false;
            document.getElementById('folderNotesInput').value = '';
            document.getElementById('folderCategoryNotesInput').value = '';
            document.getElementById('folderEditError').classList.add('hidden');
            document.getElementById('folderEditModal').classList.remove('hidden');
            document.getElementById('folderEditModal').classList.add('flex');
        }

        function editFolder(index) {
            editingFolderIndex = index;
            const folder = DATA[index];
            document.getElementById('folderEditTitle').textContent = 'Sửa danh mục';
            document.getElementById('folderNameInput').value = folder.name;
            document.getElementById('folderIdInput').value = folder.id;
            document.getElementById('folderIconInput').value = folder.icon.match(/src="([^"]+)"/)?.[1] || '';
            document.getElementById('folderMaintenanceInput').checked = folder.maintenance || false;
            document.getElementById('folderHiddenInput').checked = folder.hidden || false;
            // Load notes vào textarea (mỗi note là một dòng)
            const notesText = (folder.notes || []).join('\n');
            document.getElementById('folderNotesInput').value = notesText;

            // Load category notes
            const categoryNotesText = (folder.categoryNotes || []).join('\n');
            document.getElementById('folderCategoryNotesInput').value = categoryNotesText;

            document.getElementById('folderEditError').classList.add('hidden');
            document.getElementById('folderEditModal').classList.remove('hidden');
            document.getElementById('folderEditModal').classList.add('flex');
        }

        function closeFolderEditModal() {
            document.getElementById('folderEditModal').classList.add('hidden');
            document.getElementById('folderEditModal').classList.remove('flex');
        }

        function saveFolder() {
            const name = document.getElementById('folderNameInput').value.trim();
            const id = document.getElementById('folderIdInput').value.trim();
            const iconUrl = document.getElementById('folderIconInput').value.trim();
            const maintenance = document.getElementById('folderMaintenanceInput').checked;
            const hidden = document.getElementById('folderHiddenInput').checked;
            const notesText = document.getElementById('folderNotesInput').value.trim();
            const categoryNotesText = document.getElementById('folderCategoryNotesInput').value.trim();
            const errorEl = document.getElementById('folderEditError');

            if (!name || !id) {
                errorEl.textContent = 'Vui lòng điền đầy đủ thông tin';
                errorEl.classList.remove('hidden');
                return;
            }

            // Parse notes từ textarea (mỗi dòng là một note, bỏ qua dòng trống)
            const notes = notesText ? notesText.split('\n').map(n => n.trim()).filter(n => n.length > 0) : [];
            const categoryNotes = categoryNotesText ? categoryNotesText.split('\n').map(n => n.trim()).filter(n => n.length > 0) : [];

            const iconHtml = iconUrl ? `< img src = "${iconUrl}" alt = "${name}" class="w-full h-full rounded-full object-cover border-2 border-white/50" > ` : (editingFolderIndex >= 0 ? DATA[editingFolderIndex].icon : '');

            if (editingFolderIndex === -1) {
                // Add new folder
                DATA.push({
                    id: id,
                    name: name,
                    icon: iconHtml,
                    maintenance: maintenance,
                    hidden: hidden,
                    notes: notes,
                    categoryNotes: categoryNotes,
                    accounts: []
                });
            } else {
                // Edit existing folder
                DATA[editingFolderIndex].name = name;
                DATA[editingFolderIndex].id = id;
                DATA[editingFolderIndex].icon = iconHtml;
                DATA[editingFolderIndex].maintenance = maintenance;
                DATA[editingFolderIndex].hidden = hidden;
                DATA[editingFolderIndex].notes = notes;
                DATA[editingFolderIndex].categoryNotes = categoryNotes;
            }

            saveDataToStorage();
            closeFolderEditModal();
            loadAdminFolders();
            showFolders();
        }

        function deleteFolder(index) {
            showConfirm(
                'Xác nhận xóa',
                `Bạn có chắc muốn xóa danh mục "${DATA[index].name}" ? `,
                () => {
                    DATA.splice(index, 1);
                    saveDataToStorage();
                    loadAdminFolders();
                    showFolders();
                }
            );
        }

        async function forceSyncToFirestore() {
            if (!isAdmin()) {
                showAlert('Thông báo', 'Chỉ admin mới có quyền đồng bộ dữ liệu', 'warning');
                return;
            }

            const btn = event.target.closest('button');
            const originalText = btn.innerHTML;
            btn.disabled = true;
            btn.innerHTML = '<svg class="animate-spin h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> Đang đồng bộ...';

            try {
                await saveDataToStorage();
                showAlert('Thành công', 'Đồng bộ dữ liệu thành công!\n\nTất cả người dùng sẽ thấy thay đổi trong vài giây.', 'success');
            } catch (error) {
                console.error('Sync error:', error);
                const errorMsg = error.message || error.toString();

                if (errorMsg.includes('ERR_BLOCKED_BY_CLIENT') || errorMsg.includes('blocked')) {
                    showAlert('Lỗi: Kết nối bị chặn',
                        'Nguyên nhân: Trình chặn quảng cáo hoặc extension đang chặn Firestore.\n\n' +
                        'Cách khắc phục:\n' +
                        '1. Tắt Ad Blocker (uBlock Origin, AdBlock, etc.)\n' +
                        '2. Tắt Privacy extensions (Privacy Badger, Ghostery, etc.)\n' +
                        '3. Thêm trang này vào whitelist\n' +
                        '4. Thử trình duyệt khác (Chrome, Firefox, Edge)\n\n' +
                        'Hoặc:\n' +
                        '- Dữ liệu vẫn được lưu vào localStorage\n' +
                        '- Người dùng khác cần refresh trang để thấy thay đổi',
                        'error');
                } else if (errorMsg.includes('FIRESTORE_API_NOT_ENABLED') || errorMsg.includes('API has not been used') || errorMsg.includes('not been enabled')) {
                    showAlert('Lỗi: Firestore API chưa được bật',
                        'Vui lòng làm theo các bước sau:\n\n' +
                        '1. Truy cập link sau:\n' +
                        'https://console.developers.google.com/apis/api/firestore.googleapis.com/overview?project=trada3k-c402a\n\n' +
                        '2. Click nút "ENABLE" để bật Firestore API\n\n' +
                        '3. Đợi 1-2 phút để API được kích hoạt\n\n' +
                        '4. Refresh trang và thử lại\n\n' +
                        'Lưu ý: Dữ liệu vẫn được lưu vào localStorage trong lúc chờ.',
                        'error');
                } else {
                    showAlert('Lỗi khi đồng bộ',
                        'Lỗi: ' + errorMsg + '\n\n' +
                        'Vui lòng kiểm tra:\n' +
                        '1. Firestore đã được bật trong Firebase Console\n' +
                        '2. Security Rules đã được cấu hình đúng\n' +
                        '3. Mở Console (F12) để xem chi tiết lỗi\n\n' +
                        'Lưu ý: Dữ liệu vẫn được lưu vào localStorage',
                        'error');
                }
            } finally {
                btn.disabled = false;
                btn.innerHTML = originalText;
            }
        }

        function populateAdminFolderSelect() {
            const select = document.getElementById('adminFolderSelect');
            if (!select) return;

            // Chỉ populate nếu chưa có options (trừ option đầu tiên)
            if (select.options.length <= 1) {
                const currentValue = select.value; // Lưu giá trị hiện tại
                DATA.forEach((folder, index) => {
                    if (!folder.maintenance) {
                        const option = document.createElement('option');
                        option.value = index;
                        option.textContent = `${folder.name} (${folder.accounts ? folder.accounts.length : 0} tài khoản)`;
                        select.appendChild(option);
                    }
                });
                // Khôi phục giá trị đã chọn nếu có
                if (currentValue) {
                    select.value = currentValue;
                }
            }
        }

        function loadAccountsForAdmin() {
            const select = document.getElementById('adminFolderSelect');
            const list = document.getElementById('adminAccountsList');

            if (!select || !list) return;

            // Populate dropdown nếu chưa có
            populateAdminFolderSelect();

            const selectedIndex = parseInt(select.value);
            if (isNaN(selectedIndex) || selectedIndex < 0) {
                list.innerHTML = '<p class="text-center text-gray-500 py-4">Vui lòng chọn danh mục để xem tài khoản</p>';
                currentAdminFolderIndex = -1;
                return;
            }

            currentAdminFolderIndex = selectedIndex;
            const folder = DATA[selectedIndex];
            if (!folder) {
                list.innerHTML = '<p class="text-center text-red-500 py-4">Danh mục không tồn tại</p>';
                return;
            }

            list.innerHTML = '';

            if (!folder.accounts || folder.accounts.length === 0) {
                list.innerHTML = '<p class="text-center text-gray-500 py-4">Chưa có tài khoản nào</p>';
                // Vẫn hiển thị nút thêm
                const addBtn = document.createElement('button');
                addBtn.className = 'w-full mt-4 bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-4 py-3 rounded-xl hover:from-indigo-700 hover:to-purple-700 transition-all font-semibold flex items-center justify-center gap-2';
                addBtn.innerHTML = `
                < svg xmlns = "http://www.w3.org/2000/svg" class="h-5 w-5" fill = "none" viewBox = "0 0 24 24" stroke = "currentColor" >
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                    </svg >
                Thêm tài khoản mới
                `;
                addBtn.onclick = () => openAddAccountModal();
                list.appendChild(addBtn);
                return;
            }

            folder.accounts.forEach((acc, accIndex) => {
                const div = document.createElement('div');
                const hiddenClass = acc.hidden ? 'opacity-60' : '';
                div.className = `p-5 card mb-3 ${hiddenClass}`;
                div.innerHTML = `
                    <div class="flex items-center justify-between mb-3">
                        <div class="font-semibold text-gray-800 flex items-center gap-2">
                            ${acc.name}
                            ${acc.hidden ? '<span class="text-xs bg-orange-100 text-orange-700 px-2 py-0.5 rounded">Đã ẩn</span>' : ''}
                        </div>
                        <div class="flex gap-2">
                            <button onclick="editAccount(${selectedIndex}, ${accIndex})" class="bg-indigo-600 text-white px-3 py-1 rounded-lg text-xs font-semibold hover:bg-indigo-700 transition-colors">
                                Sửa
                            </button>
                            <button onclick="deleteAccount(${selectedIndex}, ${accIndex})" class="bg-red-600 text-white px-3 py-1 rounded-lg text-xs font-semibold hover:bg-red-700 transition-colors">
                                Xóa
                            </button>
                        </div>
                    </div >
                <div class="text-xs text-gray-600 space-y-1">
                    <div>Email: <span class="font-mono">${acc.username}</span></div>
                    <div>Password: <span class="font-mono">${acc.password}</span></div>
                    <div>Secret: <span class="font-mono">${acc.secret || '(trống)'}</span></div>
                    <div>Hiển thị 2FA: ${acc.showOtp !== false ? 'Có' : 'Không'}</div>
                </div>
            `;
                list.appendChild(div);
            });

            const addBtn = document.createElement('button');
            addBtn.className = 'w-full mt-4 bg-gradient-to-r from-indigo-600 to-purple-600 text-white px-4 py-3 rounded-xl hover:from-indigo-700 hover:to-purple-700 transition-all font-semibold flex items-center justify-center gap-2';
            addBtn.innerHTML = `
                < svg xmlns = "http://www.w3.org/2000/svg" class="h-5 w-5" fill = "none" viewBox = "0 0 24 24" stroke = "currentColor" >
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                </svg >
                Thêm tài khoản mới
            `;
            addBtn.onclick = () => {
                if (currentAdminFolderIndex === -1) {
                    showAlert('Thông báo', 'Vui lòng chọn danh mục trước', 'warning');
                    return;
                }
                openAddAccountModal();
            };
            list.appendChild(addBtn);
        }

        function openAddAccountModal() {
            if (currentAdminFolderIndex === -1) return;
            editingAccountIndex = -1;
            document.getElementById('accountEditTitle').textContent = 'Thêm tài khoản mới';
            document.getElementById('accountNameInput').value = '';
            document.getElementById('accountUsernameInput').value = '';
            document.getElementById('accountPasswordInput').value = '';
            document.getElementById('accountSecretInput').value = '';
            document.getElementById('accountShowOtpInput').checked = true;
            document.getElementById('accountHiddenInput').checked = false;
            document.getElementById('accountEditError').classList.add('hidden');
            document.getElementById('accountEditModal').classList.remove('hidden');
            document.getElementById('accountEditModal').classList.add('flex');
        }

        function editAccount(folderIndex, accountIndex) {
            editingAccountIndex = accountIndex;
            currentAdminFolderIndex = folderIndex;
            const acc = DATA[folderIndex].accounts[accountIndex];
            document.getElementById('accountEditTitle').textContent = 'Sửa tài khoản';
            document.getElementById('accountNameInput').value = acc.name || '';
            document.getElementById('accountUsernameInput').value = acc.username || '';
            document.getElementById('accountPasswordInput').value = acc.password || '';
            document.getElementById('accountSecretInput').value = acc.secret || '';
            document.getElementById('accountShowOtpInput').checked = acc.showOtp !== false;
            document.getElementById('accountHiddenInput').checked = acc.hidden || false;
            document.getElementById('accountEditError').classList.add('hidden');
            document.getElementById('accountEditModal').classList.remove('hidden');
            document.getElementById('accountEditModal').classList.add('flex');
        }

        function closeAccountEditModal() {
            document.getElementById('accountEditModal').classList.add('hidden');
            document.getElementById('accountEditModal').classList.remove('flex');
        }

        function saveAccount() {
            if (currentAdminFolderIndex === -1) return;

            const name = document.getElementById('accountNameInput').value.trim();
            const username = document.getElementById('accountUsernameInput').value.trim();
            const password = document.getElementById('accountPasswordInput').value.trim();
            const secret = document.getElementById('accountSecretInput').value.trim();
            const showOtp = document.getElementById('accountShowOtpInput').checked;
            const hidden = document.getElementById('accountHiddenInput').checked;
            const errorEl = document.getElementById('accountEditError');

            if (!name || !username || !password) {
                errorEl.textContent = 'Vui lòng điền đầy đủ thông tin';
                errorEl.classList.remove('hidden');
                return;
            }

            const accountData = {
                name: name,
                username: username,
                password: password,
                secret: secret,
                showOtp: showOtp,
                hidden: hidden
            };

            if (editingAccountIndex === -1) {
                // Add new account
                if (!DATA[currentAdminFolderIndex].accounts) {
                    DATA[currentAdminFolderIndex].accounts = [];
                }
                DATA[currentAdminFolderIndex].accounts.push(accountData);
            } else {
                // Edit existing account
                DATA[currentAdminFolderIndex].accounts[editingAccountIndex] = accountData;
            }

            saveDataToStorage();
            closeAccountEditModal();
            loadAccountsForAdmin();
            if (currentFolderIndex === currentAdminFolderIndex) {
                actuallyOpenFolder(currentFolderIndex);
            }
        }

        function deleteAccount(folderIndex, accountIndex) {
            showConfirm(
                'Xác nhận xóa',
                `Bạn có chắc muốn xóa tài khoản "${DATA[folderIndex].accounts[accountIndex].name}" ?`,
                () => {
                    DATA[folderIndex].accounts.splice(accountIndex, 1);
                    saveDataToStorage();
                    if (currentAdminFolderIndex === folderIndex) {
                        loadAccountsForAdmin();
                    }
                    if (currentFolderIndex === folderIndex) {
                        actuallyOpenFolder(folderIndex);
                    }
                }
            );
        }

        // Update admin folder select change handler
        document.addEventListener('DOMContentLoaded', () => {
            const adminFolderSelect = document.getElementById('adminFolderSelect');
            if (adminFolderSelect) {
                adminFolderSelect.addEventListener('change', loadAccountsForAdmin);
            }
        });

        function initApp() {
            // Load data when app initializes (before login)
            loadDataFromStorage().then(() => {
                console.log('Initial data loaded');
            });
            updateLoop();
            setInterval(updateLoop, 1000);
        }

        // Wait for Firebase to be ready before initializing
        setTimeout(() => {
            if (window.firebaseDb) {
                initApp();
            } else {
                console.warn('Firebase not ready, retrying...');
                setTimeout(initApp, 1000);
            }
        }, 500);
    </script>
</body>

</html>
